---

- name: GridEngine masternode Playbook
  hosts: gridengine_master
  tags:
    - gridengine
    - gridengine-master
  roles:
    - role: gridengine-master
    - role: nfs-server
      NFS_EXPORTS:
        - path: '/home'
          clients: '{{groups.gridengine_clients}}'
          options: 'rw,no_root_squash,async,no_subtree_check'
        - path: '{{SGE_VAR}}/{{SGE_CELL}}/common'
          clients: '{{groups.gridengine_clients + groups.gridengine_master}}'
          options: 'rw,no_root_squash,no_subtree_check'


- name: GridEngine worker nodes Playbook
  tags:
    - gridengine
    - gridengine-exec
  hosts: gridengine_clients
  roles:
    # we need to explicitly run `gridengine-common` before `nfs-client` to set
    # the `gridengine_cell_path` variable; having Ansible run the
    # `gridengine-common` role as a dependenciy for `gridengine-exec` sets it
    # too late and NFS mounts are not set up
    - role: gridengine-common
    - role: nfs-client
      NFS_MOUNTS:
        - fs: '{{groups.gridengine_master[0]}}:/home'
          mountpoint: '/home'
        - fs: '{{groups.gridengine_master[0]}}:{{SGE_VAR}}/{{SGE_CELL}}/common'
          mountpoint: '{{SGE_VAR}}/{{SGE_CELL}}/common'
    - role: gridengine-exec
