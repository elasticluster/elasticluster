---


- name: Add apt-key (Debain/Ubuntu)
  apt_key: id=E56151BF keyserver=keyserver.ubuntu.com state=present
  when: is_debian_or_ubuntu


- name: Add Mesosphere repo (Debain/Ubuntu)
  apt_repository:
    repo='deb http://repos.mesosphere.com/{{ansible_distribution|lower}} {{ansible_distribution_release|lower}} main'
    state=present
    update_cache=yes
  when: is_debian_or_ubuntu


- name: Add mesosphere repository (Redhat/Centos)
  yum_repository:
    name: mesosphere
    description: Mesospere YUM repo
    baseurl: http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm
  when: is_rhel_compatible


- name: Install Marathon package
  package:
    name: marathon
    state: present


- name: Create Marathon conf directory
  file: path=/etc/marathon/conf state=directory


- name: Marathon Master file
  template: src=master.j2 dest=/etc/marathon/conf/master


- name: Marathon ZK file
  template: src=zk.j2 dest=/etc/marathon/conf/zk


- name: Enable Marathon service
  service: name=marathon enabled=yes


- name: Restart all of our master services
  service:
    name: "{{item}}"
    state: restarted
  with_items:
    - zookeeper
    - mesos-master
    - marathon
