# bigtop/tasks/main.yml
---

- name: Check playbook compatibility with host platform
  fail:
    msg="PySpark/Hadoop installation only works on Debian/Ubuntu presently."
  when: not is_debian_compatible

- name: add signing key for Apache Bigtop repository
  apt_key:
    keyserver: keys.gnupg.net
    id: '{{item}}'
  with_items: '{{bigtop_signing_key}}'
  when: is_debian_compatible

- name: add Apache Bigtop repository
  apt_repository:
    # download from: http://www.apache.org/dist/bigtop/bigtop-1.2.0/repos/16.04/bigtop.list
    repo='deb http://bigtop-repos.s3.amazonaws.com/releases/{{bigtop_release}}/{{ansible_distribution|lower}}/{{ansible_distribution_version}}/x86_64 bigtop contrib'
    state=present
  when: is_debian_compatible

# this is run as task and not as a handler, since handlers are all
# executed after *all* tasks in the play have run, and we need the
# package cache to be up-to-date immediately for subsequent install
# tasks to succeed...
- name: update APT cache
  apt:
    update_cache=yes
    cache_valid_time=86400
  when: is_debian_compatible
