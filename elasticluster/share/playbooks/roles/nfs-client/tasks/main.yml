---

- name: install NFS client software (Debian/Ubuntu)
  tags:
    - nfs
    - nfs-client
  package:
    pkg='{{item}}'
    state=present
  with_items:
    - nfs-common
  when: ansible_os_family == 'Debian'

- name: install NFS client software (RHEL-compatible)
  tags:
    - nfs
    - nfs-client
  package:
    pkg='{{item}}'
    state=present
  with_items:
    - nfs-utils
  when: ansible_os_family == 'RedHat'


- name: Ensure `rpcbind` is running (Debian)
  service:
    name=rpcbind
    enabled=yes
    state=started
  when: ansible_distribution == 'Debian'

- name: Ensure `rpcbind` is running (RHEL-compatible)
  service:
    name=rpcbind
    enabled=yes
    state=started
  when: ansible_os_family == 'RedHat'

- name: Ensure `portmap` is running (Ubuntu prior to 14.04)
  service:
    name=portmap
    enabled=yes
    state=started
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_major_version|int < 14

- name: Ensure `rpcbind` is running (Ubuntu 14.04 or newer)
  service:
    name=rpcbind
    enabled=yes
    state=started
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_major_version|int >= 14


- name: Mount NFS filesystems
  tags: 
    - nfs
    - nfs-client
  include: nfsmount.yml fs='{{item}}'
  with_items: '{{NFS_MOUNTS}}'
    