---

- name: Fail if not Ubuntu 16 or greater
  fail:
    msg: "Ubuntu 16 or later is required for mesos playbook"
  when: not is_ubuntu_16_04_or_later

- name: Check if Zookeeper is running
  command: systemctl status zookeeper
  ignore_errors: yes
  changed_when: false
  register: zookeeper_status

- name: Apache Zookeeper
  include: zookeeper.yml
  when: zookeeper_status | failed

- name: Check if mesos-master is running
  command: systemctl status mesos-master
  ignore_errors: yes
  changed_when: false
  register: mesos_master_status

- name: Apache Mesos
  include: mesos.yml
  when: mesos_master_status | failed

- name: Check if Alluxio is running
  command: systemctl status alluxio
  ignore_errors: yes
  changed_when: false
  register: alluxio_status

- name: Apache Alluxio
  include: alluxio.yml
  when: alluxio_status | failed

- name: Apache Spark
  include: spark.yml

- name: Deploy profile configuration files
  copy:
    src='{{item}}'
    dest='/{{item}}'
  with_items:
    - etc/profile.d/spark.sh
    - etc/profile.d/pyspark.sh
    - etc/profile.d/alluxio.sh
