---


- debug: msg="Install Mode is {{mesos_install_mode}}"


- name: Add apt-key (Debian/Ubuntu)
  apt_key: id=E56151BF keyserver=keyserver.ubuntu.com state=present
  when: is_debian_or_ubuntu


- name: Add mesosphere repo (Debian/Ubuntu)
  apt_repository:
    repo='deb http://repos.mesosphere.com/{{ ansible_distribution | lower }} {{ ansible_distribution_release | lower }} main'
    state=present
    update_cache=yes
  when: is_debian_or_ubuntu


- name: Add mesosphere repository (Redhat/Centos)
  yum_repository:
    name: mesosphere
    description: Mesospere YUM repo
    baseurl: http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm
  when: is_rhel_compatible


- name: Install Mesos and dependencies
  package: name={{ item }} state=present
  with_items:
    - wget
    - curl
    - unzip
    - python-setuptools
    - python-dev
    - mesos


- name: Mesos ZK config file
  template: src=zk.j2 dest=/etc/mesos/zk


- include: master.yml
  when: mesos_install_mode == "master"


- include: slave.yml
  when: mesos_install_mode == "slave"